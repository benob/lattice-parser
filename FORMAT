Simple binary format for hash-table -> vector of weights model.
Benoit Favre <benoit.favre@lif.univ-mrs.fr> 2011-07-19

This file describes the binary format

Version 0
=========

0 [magic:int=0xa7dcb043]
4 [version:int] // = 0
8 [num-sections:int]
12 ([section]) * num-sections

section-header:
0 [section-id:int]
4 [next-section:int] // next section location

label section (id=0): // warning: there don't need to be the same number of labels as the number of classes
8 [num-labels:int]
12 ([label-length:short], [label-text:utf8-bytes]) * num-labels // java standard encoding for writeUTF()

weight section (id=1):
8 [label-type:int] // 0 = int
12 [weight-type:int] // 0 = float
16 [encoding:int] // 0 = sparse
20 ([num-weight-pairs:int], ([label-id:int], [weight:weight-type]) +) * num-features // sparse encoding of weights

feature id hash table section (id=2):
8 [num-features:int]
12 [num-classes:int]
16 [hash-table-size:int] // recommanded size > 2 * num-features
20 [keys-start:int]
24 ([key-offset:int]) * hash-table-size // 0 indicates empty slot, key-offset is absolute
([key-length:short], [key-text:utf8-bytes], [weight-location:int]) * num-features // weight-location is relative to weight section

note: hash code computation (from java 1.5 documentation)
Returns a hash code for this string. The hash code for a String object is computed as
 s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]
  using int arithmetic, where s[i] is the ith character of the string, n is the length of the string, and ^ indicates exponentiation. (The hash value of the empty string is zero.)

Version 1
=========

This version replaces the hashtable by a Patricia Trie, only the corresponding section is modified.

feature id mapping section (id=2):
8 [num-features:int]
12 [num-classes:int]
16 [trie-root:node]

node:
0 [weight-location:int]
4 [size-of-key:byte]
5 [key-text:utf8-bytes]
5 + n [num-children:byte]
6 + n ([child-location:int]) * num-children

